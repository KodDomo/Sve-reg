<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sveriges Regenter</title>
    
    <style>
        /* Allmänna stilar */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: grid;
            place-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        #app-container {
            width: 100%;
            max-width: 400px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 24px;
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            color: #1a4b7c;
            margin-top: 0;
            margin-bottom: 24px;
            font-size: 1.8rem;
        }
        .divider {
            border-top: 1px solid #e0e0e0;
            margin: 24px 0;
        }
        .search-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .search-controls label {
            font-weight: 500;
            color: #333;
        }
        #regent-search {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid #cdd5de;
            box-sizing: border-box; 
        }
        #regent-list-container {
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #cdd5de;
            border-radius: 8px;
            background: white;
        }
        .regent-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.95rem;
        }
        .regent-item:last-child {
            border-bottom: none;
        }
        .regent-item:hover {
            background-color: #f4f8fa;
        }
        .regent-item.selected {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .year-button {
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1;
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #cdd5de;
            background-color: #f8f9fa;
            color: #333;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        .year-button:hover { background-color: #e9ecef; }
        .year-button:active { background-color: #dbe1e6; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        #year-input {
            font-size: 1.5rem;
            text-align: center;
            width: 100px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #cdd5de;
            -moz-appearance: textfield;
            appearance: textfield;
        }
        #year-input::-webkit-outer-spin-button,
        #year-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        #result-container {
            text-align: center;
            padding-top: 24px;
        }
        .monarch-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 10px;
        }
        #monarch-name {
            font-size: 1.7rem;
            font-weight: 600;
            color: #000;
            margin: 0;
            text-align: center;
            flex-grow: 1;
        }
        .nav-button {
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1;
            padding: 8px 14px;
            border-radius: 8px;
            border: 1px solid #cdd5de;
            background-color: #f8f9fa;
            color: #333;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .nav-button:hover {
            background-color: #e9ecef;
        }
        .nav-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: #f8f9fa;
        }
        #monarch-search-link {
            display: inline-flex; 
            align-items: center;    
            justify-content: center; 
            margin: 16px 0;
            padding: 12px 18px;
            background-color: #4285F4;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 1.1rem;
            transition: background-color 0.2s;
        }
        #monarch-search-link:hover {
            background-color: #357ae8;
        }
        .info-text {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.5;
            margin: 4px 0;
        }
        #message {
            text-align: center;
            font-weight: 500;
            color: #d93025;
            font-size: 1.1rem;
            margin-top: 20px;
        }
        [hidden] {
            display: none !important;
        }

        /* === NYTT: Stil för timestamp === */
        #version-timestamp {
            font-size: 0.85rem;
            color: #888;
            text-align: center;
            margin-top: 16px;
        }
    </style>
</head>
<body>

    <div id="app-container">
        <h1>Vem regerade?</h1>
        
        <div class="search-controls">
            <label for="regent-search">Sök regent (matchar medan du skriver):</label>
            <input type="text" id="regent-search" placeholder="T.ex. Erik Segersäll">
            
            <label for="regent-list-container">...eller välj i listan:</label>
            
            <div id="regent-list-container">
                </div>
        </div>
        
        <div class="divider"></div>

        <div class="controls">
            <button id="btn-down" class="year-button" aria-label="Föregående år">▼</button>
            <input type="number" id="year-input" min="970">
            <button id="btn-up" class="year-button" aria-label="Nästa år">▲</button>
        </div>

        <div id="result-container" hidden>
            <div class="monarch-nav">
                <button id="btn-prev-regent" class="nav-button" aria-label="Föregående regent">«</button>
                <h2 id="monarch-name"></h2>
                <button id="btn-next-regent" class="nav-button" aria-label="Nästa regent">»</button>
            </div>
            
            <a id="monarch-search-link" href="#" target="_blank"></a>
            <p id="monarch-reign" class="info-text"></p>
            <p id="monarch-life" class="info-text"></p>
        </div>

        <p id="message" hidden></p>
    </div>

    <p id="version-timestamp">
        Genererad: 2025-11-11 kl. 10:59
    </p>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Regentdatabasen
            const monarchData = [
                { name: "Erik Segersäll", reign_start: 970, reign_end: 995, birth: null, death: 995 },
                { name: "Olof Skötkonung", reign_start: 995, reign_end: 1022, birth: 980, death: 1022 },
                { name: "Anund Jakob", reign_start: 1022, reign_end: 1050, birth: 1008, death: 1050 },
                { name: "Emund den gamle", reign_start: 1050, reign_end: 1060, birth: null, death: 1060 },
                { name: "Stenkil", reign_start: 1060, reign_end: 1066, birth: 1030, death: 1066 },
                { name: "Erik och Erik", reign_start: 1066, reign_end: 1067, birth: null, death: 1067 },
                { name: "Halsten", reign_start: 1067, reign_end: 1070, birth: null, death: 1084 },
                { name: "Anund Gårdske", reign_start: 1070, reign_end: 1075, birth: null, death: null },
                { name: "Håkan Röde", reign_start: 1075, reign_end: 1079, birth: null, death: null },
                { name: "Inge den äldre", reign_start: 1079, reign_end: 1084, birth: null, death: 1105 },
                { name: "Blot-Sven", reign_start: 1084, reign_end: 1087, birth: null, death: 1087 },
                { name: "Inge den äldre", reign_start: 1087, reign_end: 1105, birth: null, death: 1105 },
                { name: "Filip", reign_start: 1105, reign_end: 1118, birth: null, death: 1118 },
                { name: "Inge den yngre", reign_start: 1118, reign_end: 1125, birth: null, death: 1125 },
                { name: "Ragnvald Knaphövde", reign_start: 1125, reign_end: 1126, birth: null, death: 1126 },
                { name: "Magnus den starke", reign_start: 1125, reign_end: 1132, birth: 1106, death: 1134 },
                { name: "Sverker den äldre", reign_start: 1132, reign_end: 1156, birth: null, death: 1156 },
                { name: "Erik den helige", reign_start: 1156, reign_end: 1160, birth: 1120, death: 1160 },
                { name: "Magnus Henriksson", reign_start: 1160, reign_end: 1161, birth: null, death: 1161 },
                { name: "Karl Sverkersson", reign_start: 1161, reign_end: 1167, birth: 1130, death: 1167 },
                { name: "Knut Eriksson", reign_start: 1167, reign_end: 1196, birth: 1148, death: 1196 },
                { name: "Sverker den yngre", reign_start: 1196, reign_end: 1208, birth: 1164, death: 1210 },
                { name: "Erik Knutsson", reign_start: 1208, reign_end: 1216, birth: 1180, death: 1216 },
                { name: "Johan Sverkersson", reign_start: 1216, reign_end: 1222, birth: 1201, death: 1222 },
                { name: "Erik Eriksson (läspe och halte)", reign_start: 1222, reign_end: 1229, birth: 1216, death: 1250 },
                { name: "Knut Långe", reign_start: 1229, reign_end: 1234, birth: null, death: 1234 },
                { name: "Erik Eriksson (läspe och halte)", reign_start: 1234, reign_end: 1250, birth: 1216, death: 1250 },
                { name: "Valdemar Birgersson", reign_start: 1250, reign_end: 1275, birth: 1239, death: 1302 },
                { name: "Magnus Ladulås", reign_start: 1275, reign_end: 1290, birth: 1240, death: 1290 },
                { name: "Birger Magnusson", reign_start: 1290, reign_end: 1318, birth: 1280, death: 1321 },
                { name: "Magnus Eriksson", reign_start: 1319, reign_end: 1364, birth: 1316, death: 1374 },
                { name: "Erik Magnusson", reign_start: 1357, reign_end: 1359, birth: 1339, death: 1359 },
                { name: "Håkan Magnusson", reign_start: 1362, reign_end: 1364, birth: 1340, death: 1380 },
                { name: "Albrekt av Mecklenburg", reign_start: 1364, reign_end: 1389, birth: 1338, death: 1412 },
                { name: "Margareta", reign_start: 1389, reign_end: 1412, birth: 1353, death: 1412 },
                { name: "Erik av Pommern", reign_start: 1396, reign_end: 1439, birth: 1382, death: 1459 },
                { name: "Kristofer av Bayern", reign_start: 1441, reign_end: 1448, birth: 1416, death: 1448 },
                { name: "Karl Knutsson (Bonde)", reign_start: 1448, reign_end: 1457, birth: 1409, death: 1470 },
                { name: "Kristian I", reign_start: 1457, reign_end: 1464, birth: 1426, death: 1481 },
                { name: "Karl Knutsson (Bonde)", reign_start: 1464, reign_end: 1465, birth: 1409, death: 1470 },
                { name: "Karl Knutsson (Bonde)", reign_start: 1467, reign_end: 1470, birth: 1409, death: 1470 },
                { name: "Sten Sture den äldre", reign_start: 1470, reign_end: 1497, birth: 1440, death: 1503 },
                { name: "Hans (Johan II)", reign_start: 1497, reign_end: 1501, birth: 1455, death: 1513 },
                { name: "Sten Sture den äldre", reign_start: 1501, reign_end: 1503, birth: 1440, death: 1503 },
                { name: "Svante Nilsson (Sture)", reign_start: 1504, reign_end: 1512, birth: 1460, death: 1512 },
                { name: "Sten Sture den yngre", reign_start: 1512, reign_end: 1520, birth: 1493, death: 1520 },
                { name: "Kristian II", reign_start: 1520, reign_end: 1521, birth: 1481, death: 1559 },
                { name: "Gustav Vasa", reign_start: 1523, reign_end: 1560, birth: 1496, death: 1560 },
                { name: "Erik XIV", reign_start: 1560, reign_end: 1568, birth: 1533, death: 1577 },
                { name: "Johan III", reign_start: 1568, reign_end: 1592, birth: 1537, death: 1592 },
                { name: "Sigismund", reign_start: 1592, reign_end: 1599, birth: 1566, death: 1632 },
                { name: "Karl IX", reign_start: 1599, reign_end: 1611, birth: 1550, death: 1611 },
                { name: "Gustav II Adolf", reign_start: 1611, reign_end: 1632, birth: 1594, death: 1632 },
                { name: "Kristina", reign_start: 1632, reign_end: 1654, birth: 1626, death: 1689 },
                { name: "Karl X Gustav", reign_start: 1654, reign_end: 1660, birth: 1622, death: 1660 },
                { name: "Karl XI", reign_start: 1660, reign_end: 1697, birth: 1655, death: 1697 },
                { name: "Karl XII", reign_start: 1697, reign_end: 1718, birth: 1682, death: 1718 },
                { name: "Ulrika Eleonora", reign_start: 1718, reign_end: 1720, birth: 1688, death: 1741 },
                { name: "Fredrik I", reign_start: 1720, reign_end: 1751, birth: 1676, death: 1751 },
                { name: "Adolf Fredrik", reign_start: 1751, reign_end: 1771, birth: 1710, death: 1771 },
                { name: "Gustav III", reign_start: 1771, reign_end: 1792, birth: 1746, death: 1792 },
                { name: "Gustav IV Adolf", reign_start: 1792, reign_end: 1809, birth: 1778, death: 1837 },
                { name: "Karl XIII", reign_start: 1809, reign_end: 1818, birth: 1748, death: 1818 },
                { name: "Karl XIV Johan", reign_start: 1818, reign_end: 1844, birth: 1763, death: 1844 },
                { name: "Oscar I", reign_start: 1844, reign_end: 1859, birth: 1799, death: 1859 },
                { name: "Karl XV", reign_start: 1859, reign_end: 1872, birth: 1826, death: 1872 },
                { name: "Oscar II", reign_start: 1872, reign_end: 1907, birth: 1829, death: 1907 },
                { name: "Gustaf V", reign_start: 1907, reign_end: 1950, birth: 1858, death: 1950 },
                { name: "Gustaf VI Adolf", reign_start: 1950, reign_end: 1973, birth: 1882, death: 1973 },
                { name: "Carl XVI Gustaf", reign_start: 1973, reign_end: "nuvarande", birth: 1946, death: null }
            ];

            // Hämta referenser till alla element
            const yearInput = document.getElementById('year-input');
            const btnDown = document.getElementById('btn-down');
            const btnUp = document.getElementById('btn-up');
            const regentSearch = document.getElementById('regent-search');
            const regentListContainer = document.getElementById('regent-list-container');
            const resultContainer = document.getElementById('result-container');
            const monarchName = document.getElementById('monarch-name');
            const monarchSearchLink = document.getElementById('monarch-search-link');
            const monarchReign = document.getElementById('monarch-reign');
            const monarchLife = document.getElementById('monarch-life');
            const message = document.getElementById('message');
            const btnPrevRegent = document.getElementById('btn-prev-regent');
            const btnNextRegent = document.getElementById('btn-next-regent');
            
            const currentYear = new Date().getFullYear(); 
            const earliestYear = 970;
            
            // Global variabel för att hålla reda på visad regent
            let currentMonarchObject = null;

            // Funktion: Visar en specifik regent
            function displayMonarch(monarch) {
                // Sätt den globala variabeln
                currentMonarchObject = monarch; 
                
                if (monarch) {
                    monarchName.textContent = monarch.name;
                    const searchTerm = monarch.name;
                    const googleSearchUrl = `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(searchTerm)}`;
                    monarchSearchLink.href = googleSearchUrl;
                    monarchSearchLink.textContent = `Sök bild på ${monarch.name}`;
                    
                    const reignEnd = (monarch.reign_end === 'nuvarande') ? currentYear : monarch.reign_end;
                    const reignEndText = (monarch.reign_end === 'nuvarande') ? 'nuvarande' : monarch.reign_end;
                    monarchReign.textContent = `Regent: ${monarch.reign_start}–${reignEndText}`;
                    
                    const birthYear = monarch.birth || 'Okänt';
                    const deathYear = monarch.death || 'Okänt';

                    if (birthYear === 'Okänt' && deathYear === 'Okänt') {
                        monarchLife.textContent = `Levde: Okänt`;
                    } else if (birthYear === 'Okänt') {
                        monarchLife.textContent = `Levde: Okänt–${deathYear}`;
                    } else if (deathYear === 'Okänt') {
                         monarchLife.textContent = `Född: ${birthYear}`;
                    } else if (monarch.death === null) {
                        monarchLife.textContent = `Född: ${monarch.birth}`;
                    } else {
                        monarchLife.textContent = `Levde: ${birthYear}–${deathYear}`;
                    }

                    syncSelectedListItem(monarch.reign_start, monarch.name);
                    
                    // Sätt årtalsrutan till regentens startår
                    yearInput.value = monarch.reign_start;

                    resultContainer.hidden = false;
                    message.hidden = true;
                    
                    const currentIndex = monarchData.findIndex(m => m.name === monarch.name && m.reign_start === monarch.reign_start);
                    btnPrevRegent.disabled = (currentIndex === 0);
                    btnNextRegent.disabled = (currentIndex === monarchData.length - 1);
                    
                } else {
                    resultContainer.hidden = true;
                    syncSelectedListItem(null); 
                    
                    btnPrevRegent.disabled = true;
                    btnNextRegent.disabled = true;
                    
                    const numericYear = parseInt(yearInput.value, 10);
                    if (numericYear < earliestYear) {
                         message.textContent = `Data saknas före ca ${earliestYear}.`;
                    } else if (numericYear > currentYear) {
                         message.textContent = `Året ${numericYear} har ännu inte inträffat.`;
                    } else {
                         message.textContent = `Data saknas för årtal ${numericYear}. (T.ex. under maktkamper/interregnum).`;
                    }
                    message.hidden = false;
                }
            }
            
            // Funktion: Hittar en regent baserat på år
            function findMonarchByYear(year) {
                let numericYear = parseInt(year, 10);
                
                if (isNaN(numericYear)) {
                    numericYear = currentYear;
                }
                
                // Söklogiken som vänder på listan
                const monarch = [...monarchData].reverse().find(m => {
                    const reignEnd = (m.reign_end === 'nuvarande') ? currentYear : m.reign_end;
                    return numericYear >= m.reign_start && numericYear <= reignEnd;
                });
                return monarch;
            }

            // Funktion: Fyller <div>-listan
            function populateList(filter = "") {
                const lowerFilter = filter.toLowerCase();
                regentListContainer.innerHTML = ""; 

                monarchData.forEach(monarch => {
                    const monarchName = monarch.name.toLowerCase();
                    
                    if (monarchName.includes(lowerFilter)) {
                        const item = document.createElement('div');
                        item.className = 'regent-item';
                        item.dataset.year = monarch.reign_start; 
                        item.dataset.name = monarch.name;
                        
                        const reignEndText = (monarch.reign_end === 'nuvarande') ? 'nu' : monarch.reign_end;
                        item.textContent = `${monarch.name} (${monarch.reign_start}–${reignEndText})`;
                        
                        item.addEventListener('click', handleItemClick);
                        
                        regentListContainer.appendChild(item);
                    }
                });
            }
            
            // Funktion: Synkroniserar list-markering
            function syncSelectedListItem(selectedYear, selectedName) {
                for (const item of regentListContainer.children) {
                    const itemYear = item.dataset.year;
                    const itemName = item.dataset.name;
                    
                    const isSelected = (itemYear === String(selectedYear) && itemName === selectedName);
                    
                    item.classList.toggle('selected', isSelected);
                    
                    if (isSelected) {
                        item.scrollIntoView({ block: 'nearest' });
                    }
                }
            }

            // --- Händelsehanterare ---
            
            function handleYearInput() {
                if (parseInt(yearInput.value, 10) > currentYear) {
                    yearInput.value = currentYear;
                }
                
                if (yearInput.value) {
                    if (regentSearch.value !== "") {
                        regentSearch.value = "";
                        populateList("");
                    }
                    const monarch = findMonarchByYear(yearInput.value);
                    displayMonarch(monarch);
                } else {
                    currentMonarchObject = null; // Nollställ
                    displayMonarch(null); 
                    message.textContent = "Välj ett årtal mellan " + earliestYear + " och " + currentYear;
                    message.hidden = false;
                }
            }

            function handleUp() {
                let nextYear = (parseInt(yearInput.value, 10) || (currentYear - 1)) + 1;
                if (nextYear > currentYear) {
                    nextYear = currentYear;
                }
                yearInput.value = nextYear;
                
                if (regentSearch.value !== "") {
                    regentSearch.value = "";
                    populateList("");
                }
                const monarch = findMonarchByYear(yearInput.value);
                displayMonarch(monarch);
            }

            function handleDown() {
                let prevYear = (parseInt(yearInput.value, 10) || currentYear) - 1;
                if (prevYear < earliestYear) {
                    prevYear = earliestYear;
                }
                yearInput.value = prevYear;

                if (regentSearch.value !== "") {
                    regentSearch.value = "";
                    populateList("");
                }
                const monarch = findMonarchByYear(yearInput.value);
                displayMonarch(monarch);
            }
            
            // Sök-input (live-sökning)
            function handleSearchInput() {
                populateList(regentSearch.value);
            }
            
            // Klick på ett <div>-objekt
            function handleItemClick(event) {
                const selectedYear = event.currentTarget.dataset.year;
                const selectedName = event.currentTarget.dataset.name;
                
                if (selectedYear) {
                    regentSearch.value = "";
                    populateList(""); 
                    
                    const monarch = monarchData.find(m => m.reign_start == selectedYear && m.name == selectedName);
                    displayMonarch(monarch); 
                }
            }
            
            // === KORRIGERADE FUNKTIONER FÖR REGENT-NAVIGERING ===
            
            function handleNextRegent() {
                if (!currentMonarchObject) return; 
                
                const currentIndex = monarchData.findIndex(m => 
                    m.name === currentMonarchObject.name && 
                    m.reign_start === currentMonarchObject.reign_start
                );

                if (currentIndex !== -1 && currentIndex < monarchData.length - 1) {
                    const nextMonarch = monarchData[currentIndex + 1];
                    displayMonarch(nextMonarch);
                }
            }

            function handlePrevRegent() {
                if (!currentMonarchObject) return; 

                const currentIndex = monarchData.findIndex(m => 
                    m.name === currentMonarchObject.name && 
                    m.reign_start === currentMonarchObject.reign_start
                );
                
                if (currentIndex > 0) {
                    const prevMonarch = monarchData[currentIndex - 1];
                    displayMonarch(prevMonarch);
                }
            }

            // --- Koppla alla händelsehanterare ---
            yearInput.addEventListener('input', handleYearInput);
            btnUp.addEventListener('click', handleUp);
            btnDown.addEventListener('click', handleDown);
            
            regentSearch.addEventListener('input', handleSearchInput);
            
            btnPrevRegent.addEventListener('click', handlePrevRegent);
            btnNextRegent.addEventListener('click', handleNextRegent);

            // --- Initialisering ---
            populateList(); // Fyll på listan med ALLA regenter
            
            yearInput.value = currentYear;
            yearInput.min = earliestYear;
            yearInput.max = currentYear; 
            
            const initialMonarch = findMonarchByYear(currentYear);
            displayMonarch(initialMonarch);
        });
    </script>

</body>
</html>
